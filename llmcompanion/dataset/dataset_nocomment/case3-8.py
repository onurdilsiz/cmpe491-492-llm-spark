import sys
import pandas as pd
from pyspark import SparkContext
import pyspark
import numpy
from pyspark.mllib.linalg.distributed import IndexedRowMatrix, IndexedRow
from pyspark.sql import SparkSession
import csv
import os
os.environ['PYSPARK_PYTHON'] = 'virt/bin/python'


def as_block_matrix(rdd, rowsPerBlock=65000, colsPerBlock=65000):
    return IndexedRowMatrix(
        rdd.zipWithIndex().map(lambda xi: IndexedRow(xi[1], xi[0]))
    ).toBlockMatrix(rowsPerBlock, colsPerBlock)


def train_rbm(data, spark_context, visible_nodes, hidden_nodes, learning_rate=.1, iterations=30):
    SparkSession(spark_context) # without this `'PipelinedRDD' object has no attribute 'toDF'` will be thrown

    weights = numpy.asarray(numpy.random.uniform(
        low=-0.1 * numpy.sqrt(6. / (hidden_nodes + visible_nodes)),
        high=0.1 * numpy.sqrt(6. / (hidden_nodes + visible_nodes)),
        size=(visible_nodes, hidden_nodes)))
    weights = numpy.insert(weights, 0, 0, axis=0)
    weights = numpy.insert(weights, 0, 0, axis=1)

    num_data_entries = numpy.array(data).shape[0]

    # Insert bias units of 1 into the first column.
    data = numpy.insert(numpy.array(data), 0, 1, axis=1)

    print(weights)
    print(data)

    # Creating RDD's from vectors
    weightsRDD = spark_context.parallelize(weights)
    dataRDD = spark_context.parallelize(data)

    weightsBlockMatrix = as_block_matrix(weightsRDD)
    dataBlockMatrix = as_block_matrix(dataRDD)


    for iteration in range(iterations):
        #positive phase
        pos_hidden_activations = dataBlockMatrix.multiply(weightsBlockMatrix)

        # pulling data out of the cluster to run the sigmoid function
        pos_hidden_probs = 1.0 / (1 + numpy.exp(-pos_hidden_activations.blocks.collect()[0][1].toArray()))
        # overwrite the bias unit with 1 after the transformations
        pos_hidden_probs[:, 0] = 1
        # creating states from the hidden probabilities
        pos_hidden_states = pos_hidden_probs > numpy.random.rand(num_data_entries, hidden_nodes + 1)
        # putting states and probabilities into the cluster
        pos_hidden_states = as_block_matrix(spark_context.parallelize(pos_hidden_states))
        pos_hidden_probs = as_block_matrix(spark_context.parallelize(pos_hidden_probs))

        pos_associations = dataBlockMatrix.transpose().multiply(pos_hidden_probs)

        # negative phase
        neg_visible_activations = pos_hidden_states.multiply(weightsBlockMatrix.transpose())

        # pulling data out of the cluster to run the sigmoid function
        neg_visible_probs = 1.0 / (1 + numpy.exp(-neg_visible_activations.blocks.collect()[0][1].toArray()))
        # overwrite the bias unit with 1 after the transformations
        neg_visible_probs[:, 0] = 1
        # putting probabilities back into the cluster
        neg_visible_probs = as_block_matrix(spark_context.parallelize(neg_visible_probs))

        neg_hidden_activations = neg_visible_probs.multiply(weightsBlockMatrix)
        # pulling data out of the cluster to run the sigmoid function
        neg_hidden_probs = 1.0 / (1 + numpy.exp(-neg_hidden_activations.blocks.collect()[0][1].toArray()))
        # putting data back in after applying the sigmoid function
        neg_hidden_probs = as_block_matrix(spark_context.parallelize(neg_hidden_probs))

        neg_associations = neg_visible_probs.transpose().multiply(neg_hidden_probs)

        # Updating weights
        weights = numpy.copy(weightsBlockMatrix.blocks.collect()[0][1].toArray())
        weights += learning_rate * ((pos_associations.blocks.collect()[0][1].toArray() - neg_associations.blocks.collect()[0][1].toArray()) / num_data_entries)
        weightsBlockMatrix = as_block_matrix(spark_context.parallelize(weights))

        cost = numpy.sum((data - neg_visible_probs.blocks.collect()[0][1].toArray()) ** 2)
        print("Iteration %s: cost is %s" % (iteration, cost))

    # returns the trained weights of the network
    return weightsBlockMatrix.blocks.collect()[0][1].toArray()





if __name__ == '__main__':

    conf = pyspark.SparkConf().setAll([('spark.executor.memory', '6g'), ('spark.executor.cores', '8'), ('spark.cores.max', '8'), ('spark.driver.memory','6g')])
    sc = SparkContext(appName="RBM", conf=conf)

    # these are copy and pasted face embedding outputted from "spark_webcam_streaming.py" of my face
    myFaceEmbeddingsData = [[-0.15760964155197144, 0.1414318084716797, 0.09475050866603851, -0.023935820907354355, -0.1531723439693451, 0.04692627489566803, -0.05397776514291763, -0.08153611421585083, 0.07818450778722763, -0.15684011578559875, 0.16471844911575317, -0.010832671076059341, -0.21365506947040558, 0.049668606370687485, 0.028148235753178596, 0.19976243376731873, -0.10688098520040512, -0.1268075555562973, -0.15996915102005005, -0.10255630314350128, 0.011570937000215054, 0.1324082911014557, -0.09991578757762909, 0.04518184810876846, -0.10349902510643005, -0.2607620060443878, -0.07570309937000275, -0.043799012899398804, 0.05597518011927605, -0.06321042031049728, -0.03447425365447998, 0.05829501152038574, -0.12241983413696289, 0.03590736538171768, 0.022702712565660477, 0.06025203317403793, -0.040939811617136, -0.06333453208208084, 0.1970326006412506, 0.010278656147420406, -0.20095714926719666, 0.01812044531106949, 0.0688047856092453, 0.23270873725414276, 0.1678764373064041, -0.009629059582948685, 0.060426078736782074, -0.0587698295712471, 0.09698181599378586, -0.2465621381998062, 0.0647427886724472, 0.1297197788953781, 0.037442341446876526, 0.13399706780910492, 0.007683797739446163, -0.2381402999162674, -0.015257625840604305, 0.11317278444766998, -0.15971815586090088, 0.13273368775844574, 0.09257854521274567, -0.2190200537443161, -0.08597584068775177, -0.040030647069215775, 0.17286504805088043, 0.12333544343709946, -0.09390083700418472, -0.22836394608020782, 0.16339650750160217, -0.18822191655635834, -0.05034102872014046, 0.10204143822193146, -0.13752654194831848, -0.16113081574440002, -0.2948451638221741, 0.09906761348247528, 0.3573370575904846, 0.1820536106824875, -0.16076909005641937, 0.01819809339940548, 0.039805762469768524, -0.01730985753238201, 0.12226079404354095, 0.16237756609916687, -0.01865202561020851, -0.07995057106018066, -0.04745762422680855, 0.09317769855260849, 0.24781161546707153, -0.007830237969756126, -0.018575264140963554, 0.27065521478652954, 0.05223660171031952, -0.00211363285779953, -0.007342536002397537, 0.08958742767572403, -0.03394387289881706, -0.1034095287322998, -0.0496751070022583, 0.024869367480278015, 0.03742305934429169, -0.06589570641517639, -0.0031926678493618965, 0.12004560232162476, -0.10330283641815186, 0.19810374081134796, -0.07151982933282852, 0.04722486063838005, -0.07034332305192947, -0.020458107814192772, -0.09604498744010925, 0.0020128777250647545, 0.20344634354114532, -0.13569095730781555, 0.1700347661972046, 0.1770397424697876, -0.0046071396209299564, 0.11825638264417648, 0.10865317285060883, 0.12118501961231232, 0.02378462255001068, -0.04441749304533005, -0.2107435017824173, -0.06081711873412132, 0.10541325062513351, -0.05253365635871887, 0.03584843501448631, 0.07103921473026276],
                            [-0.1622639149427414, 0.1516929417848587, 0.07006102800369263, -0.033233240246772766, -0.16300272941589355, 0.02902943268418312, -0.03995274379849434, -0.060731127858161926, 0.08916370570659637, -0.1770133078098297, 0.16328175365924835, -0.0034526800736784935, -0.21033048629760742, 0.051312852650880814, 0.005245724692940712, 0.19797389209270477, -0.10045173019170761, -0.14246882498264313, -0.16678760945796967, -0.11545436084270477, 0.010608101263642311, 0.13141965866088867, -0.10428006201982498, 0.0552460178732872, -0.08898721635341644, -0.25372251868247986, -0.0577537938952446, -0.028059352189302444, 0.04032544046640396, -0.08379974961280823, -0.007638104259967804, 0.06077023223042488, -0.11794494092464447, 0.04551876336336136, 0.02352205477654934, 0.062212660908699036, -0.04231979325413704, -0.05903042107820511, 0.21922163665294647, 0.02985234372317791, -0.20421336591243744, 0.013483213260769844, 0.0740135908126831, 0.2550610303878784, 0.16171354055404663, -0.0241974126547575, 0.05851304531097412, -0.08098578453063965, 0.10531836748123169, -0.2577087879180908, 0.05811276659369469, 0.14127005636692047, 0.02797532081604004, 0.12818996608257294, -0.003686370328068733, -0.22817684710025787, -0.023923810571432114, 0.13329483568668365, -0.16025134921073914, 0.11392971873283386, 0.09637680649757385, -0.2088073194026947, -0.11054704338312149, -0.05504892021417618, 0.18240100145339966, 0.13145975768566132, -0.11484228819608688, -0.2407016158103943, 0.15109695494174957, -0.2088872790336609, -0.0579490102827549, 0.12992919981479645, -0.11443934589624405, -0.16236048936843872, -0.27016395330429077, 0.11354143917560577, 0.36547452211380005, 0.1962338089942932, -0.13495050370693207, 0.0027311379089951515, 0.02031221054494381, -0.026670891791582108, 0.11719033867120743, 0.17039409279823303, -0.026329878717660904, -0.09122459590435028, -0.04578902944922447, 0.09398500621318817, 0.2441355586051941, 0.010622805915772915, -0.03695596382021904, 0.247714102268219, 0.06684587895870209, 0.0020732013508677483, -0.02963981404900551, 0.08464370667934418, -0.05667785555124283, -0.09414264559745789, -0.05325315147638321, 0.014954494312405586, 0.01102413795888424, -0.05279173329472542, -0.014584599062800407, 0.1130240187048912, -0.09086445719003677, 0.20151694118976593, -0.08128367364406586, 0.029335934668779373, -0.07949256896972656, -0.021205833181738853, -0.08056296408176422, 0.000846492126584053, 0.17737030982971191, -0.13842180371284485, 0.1607191562652588, 0.1648552119731903, 0.014974175952374935, 0.1303357630968094, 0.12507377564907074, 0.11574611812829971, 0.032860174775123596, -0.05624014511704445, -0.20657317340373993, -0.052512750029563904, 0.09842163324356079, -0.045787543058395386, 0.053080327808856964, 0.03757590800523758],
                            [-0.13884639739990234, 0.11039680242538452, 0.10059859603643417, -0.04429294168949127, -0.18854299187660217, 0.03562931716442108, -0.03064846806228161, -0.04563351720571518, 0.11134886741638184, -0.16286267340183258, 0.18024452030658722, 0.004222260322421789, -0.19371165335178375, 0.05674939975142479, 0.00592940766364336, 0.2168264091014862, -0.06966087222099304, -0.14140693843364716, -0.1650209128856659, -0.12560194730758667, 0.024786492809653282, 0.129310742020607, -0.10890436172485352, 0.06458798050880432, -0.10631026327610016, -0.28969812393188477, -0.07799725979566574, -0.03864285722374916, 0.03813404217362404, -0.09024633467197418, -0.031512919813394547, 0.0899987444281578, -0.13683702051639557, 0.004930425435304642, 0.034511346369981766, 0.056277595460414886, -0.04940010979771614, -0.0869894027709961, 0.1978113353252411, 0.05320587381720543, -0.20952779054641724, 0.040963511914014816, 0.06862188875675201, 0.24639230966567993, 0.16499315202236176, -0.00891580618917942, 0.07711038738489151, -0.03302675113081932, 0.10752857476472855, -0.2597242593765259, 0.06272883713245392, 0.12166526913642883, 0.05830397456884384, 0.10174731910228729, 0.022378448396921158, -0.20718753337860107, -0.0210171677172184, 0.11708027124404907, -0.18289896845817566, 0.1030014380812645, 0.0900917574763298, -0.21026499569416046, -0.10406962037086487, -0.05832388252019882, 0.18111790716648102, 0.145799919962883, -0.09847710281610489, -0.21492493152618408, 0.17992350459098816, -0.1787581443786621, -0.04409049078822136, 0.08921174705028534, -0.14728450775146484, -0.144507497549057, -0.26274433732032776, 0.11868047714233398, 0.403298020362854, 0.18571718037128448, -0.15929697453975677, 0.016411762684583664, 0.02104225568473339, -0.0014043273404240608, 0.09163647145032883, 0.15665337443351746, -0.008570194244384766, -0.07532089203596115, -0.04393045976758003, 0.09662668406963348, 0.2279120683670044, 0.011794467456638813, -0.02788412570953369, 0.26462364196777344, 0.05594450607895851, 0.004951749928295612, -0.010026066564023495, 0.07330073416233063, -0.0703325942158699, -0.1018180251121521, -0.04942259192466736, 0.010716901160776615, 0.004442746751010418, -0.019078783690929413, -0.009061087854206562, 0.1223101019859314, -0.09357979893684387, 0.20249664783477783, -0.10315202176570892, 0.03425639122724533, -0.09320025891065598, -0.011192789301276207, -0.08346588164567947, -0.0042264205403625965, 0.1526382565498352, -0.12805239856243134, 0.13020263612270355, 0.1530531346797943, -0.01674162596464157, 0.11576922237873077, 0.10869207233190536, 0.088170126080513, 0.04187934473156929, -0.05771657079458237, -0.2265949249267578, -0.06736308336257935, 0.1134335845708847, -0.06825701147317886, 0.04582448676228523, 0.04804961010813713],
                            [-0.13664595782756805, 0.11353981494903564, 0.08530474454164505, -0.0282987579703331, -0.1501779705286026, 0.031245172023773193, -0.039355821907520294, -0.028608977794647217, 0.09964442998170853, -0.18168434500694275, 0.17308688163757324, 0.017694801092147827, -0.19168433547019958, 0.051163721829652786, 0.011637027375400066, 0.20142434537410736, -0.08683659881353378, -0.1316685825586319, -0.15346986055374146, -0.11767656356096268, 0.03448536619544029, 0.12444651871919632, -0.0990450456738472, 0.026065044105052948, -0.08325272798538208, -0.27239790558815, -0.0732027068734169, -0.020178059116005898, 0.05772751569747925, -0.07518072426319122, -0.03010869026184082, 0.06926024705171585, -0.11396965384483337, 0.02992560714483261, 0.028750266879796982, 0.05245811864733696, -0.03855740651488304, -0.0779055505990982, 0.2003212571144104, 0.03350888565182686, -0.20683632791042328, 0.022566094994544983, 0.05343326926231384, 0.24421560764312744, 0.1557028740644455, -0.021769091486930847, 0.0541020929813385, -0.05201096460223198, 0.09467285126447678, -0.24175643920898438, 0.06374561786651611, 0.12771570682525635, 0.054661452770233154, 0.11999969929456711, 0.007091372273862362, -0.20602765679359436, 0.002721507102251053, 0.10461248457431793, -0.17163808643817902, 0.08917935192584991, 0.08513151109218597, -0.19876255095005035, -0.09351632744073868, -0.051686402410268784, 0.15534663200378418, 0.13591018319129944, -0.09430049359798431, -0.24687661230564117, 0.14566321671009064, -0.18888945877552032, -0.04340263828635216, 0.10651599615812302, -0.1393357366323471, -0.15604642033576965, -0.2508470416069031, 0.09962066262960434, 0.37727686762809753, 0.19002355635166168, -0.1414148211479187, 0.023752745240926743, 0.03791017085313797, -0.030035000294446945, 0.12709802389144897, 0.15929870307445526, -0.02305120788514614, -0.06895112991333008, -0.043850455433130264, 0.09552507102489471, 0.2286948561668396, 0.004454891197383404, -0.06540597975254059, 0.22456838190555573, 0.0484880730509758, 0.013434459455311298, -0.0066252234391868114, 0.07565104961395264, -0.03937949612736702, -0.07330454140901566, -0.051703788340091705, 0.015145434066653252, 0.01706082932651043, -0.060510654002428055, -0.024877924472093582, 0.11032126843929291, -0.0850948914885521, 0.2092054933309555, -0.08360521495342255, 0.047924742102622986, -0.07109922170639038, -0.0062361834570765495, -0.09542633593082428, 0.010693513788282871, 0.15934978425502777, -0.12502698600292206, 0.15727460384368896, 0.17074884474277496, 0.00821303203701973, 0.12184353172779083, 0.11806774139404297, 0.10143893957138062, 0.03450175002217293, -0.05145122855901718, -0.22719281911849976, -0.059816062450408936, 0.08813898265361786, -0.04949771240353584, 0.061327531933784485, 0.04326898232102394],
                            [-0.13767346739768982, 0.13142597675323486, 0.08005248010158539, -0.02950994484126568, -0.1553725302219391, 0.046079687774181366, -0.036517634987831116, -0.05045453831553459, 0.12156141549348831, -0.15194234251976013, 0.16301624476909637, 0.022732656449079514, -0.22226004302501678, 0.029657911509275436, 0.03825462609529495, 0.1887427270412445, -0.0810803472995758, -0.15257596969604492, -0.15492279827594757, -0.09806091338396072, 0.03490490838885307, 0.0826861709356308, -0.11641328781843185, 0.03901880234479904, -0.10237348824739456, -0.275999516248703, -0.08019052445888519, -0.02778378315269947, 0.04855417460203171, -0.07957731187343597, -0.012570458464324474, 0.07191258668899536, -0.14559349417686462, 0.006138976663351059, 0.017980821430683136, 0.07843946665525436, -0.019300516694784164, -0.0872088223695755, 0.1911855787038803, -0.006276468746364117, -0.21894879639148712, 0.026495810598134995, 0.055319081991910934, 0.2081982046365738, 0.14507673680782318, -0.03141285479068756, 0.08013427257537842, -0.050481315702199936, 0.09251239895820618, -0.22652862966060638, 0.09770427644252777, 0.14050327241420746, 0.07919824123382568, 0.11081035435199738, 0.02274714969098568, -0.22351376712322235, -0.0207380224019289, 0.11230766773223877, -0.17726357281208038, 0.09504836797714233, 0.10334432125091553, -0.1810874193906784, -0.10305270552635193, -0.06432059407234192, 0.13677091896533966, 0.1361137181520462, -0.10149474442005157, -0.2394658774137497, 0.16823391616344452, -0.1745346188545227, -0.0340520404279232, 0.09762321412563324, -0.1414729207754135, -0.1636039763689041, -0.2785738706588745, 0.1281990259885788, 0.37737467885017395, 0.18178057670593262, -0.16511215269565582, 0.023222217336297035, 0.02177782543003559, -0.03367576003074646, 0.08178594708442688, 0.15107591450214386, -0.0064486488699913025, -0.06334340572357178, -0.04414151608943939, 0.11897380650043488, 0.22870472073554993, 0.021916385740041733, -0.03453562408685684, 0.23705460131168365, 0.04775482416152954, -0.012104392051696777, -0.024610042572021484, 0.09980972856283188, -0.03155052661895752, -0.07853291183710098, -0.04962020367383957, 0.03385040909051895, 0.03844185918569565, -0.05024672672152519, -0.029215965420007706, 0.112027108669281, -0.08973991870880127, 0.18759316205978394, -0.06911054998636246, 0.04576753452420235, -0.07883955538272858, -0.015623675659298897, -0.1102164164185524, 0.004728675354272127, 0.1797695755958557, -0.14469170570373535, 0.16489320993423462, 0.15005123615264893, -0.019190136343240738, 0.10783267021179199, 0.11179665476083755, 0.11902336776256561, 0.06348999589681625, -0.0817432850599289, -0.23154011368751526, -0.07584971189498901, 0.09628473222255707, -0.05098141357302666, 0.04460884630680084, 0.06603879481554031],
                            [-0.1380562037229538, 0.13344936072826385, 0.0528460294008255, -0.03687566518783569, -0.1501445174217224, 0.05029292777180672, -0.03251366317272186, -0.06560783088207245, 0.13179035484790802, -0.16048049926757812, 0.1779070347547531, 0.02595607191324234, -0.2119431495666504, 0.02560489997267723, 0.016898861154913902, 0.20208418369293213, -0.11282079666852951, -0.15577156841754913, -0.15029431879520416, -0.11834327131509781, 0.026795659214258194, 0.11399228125810623, -0.09936217218637466, 0.06354847550392151, -0.1215752512216568, -0.2541676461696625, -0.06912549585103989, -0.031248681247234344, 0.051058996468782425, -0.07523378729820251, 0.0005814060568809509, 0.07551239430904388, -0.15162113308906555, 0.020321905612945557, 0.028637077659368515, 0.07739077508449554, -0.03725419193506241, -0.0766102522611618, 0.21022218465805054, 0.02708389237523079, -0.19100205600261688, -0.0006963489577174187, 0.05697217583656311, 0.23049567639827728, 0.15654224157333374, -0.02715906873345375, 0.06529321521520615, -0.06926533579826355, 0.0996285006403923, -0.25083377957344055, 0.07411730289459229, 0.15106889605522156, 0.04672800004482269, 0.11752445995807648, -0.014344432391226292, -0.22625721991062164, -0.011260760016739368, 0.14813466370105743, -0.18687410652637482, 0.10672497004270554, 0.09540706872940063, -0.20139536261558533, -0.09471138566732407, -0.038955800235271454, 0.1594613492488861, 0.13566045463085175, -0.10650323331356049, -0.24202436208724976, 0.16096721589565277, -0.19576957821846008, -0.0457075797021389, 0.1123911440372467, -0.1289554089307785, -0.1754424124956131, -0.2916249632835388, 0.10032404214143753, 0.3917047083377838, 0.18750812113285065, -0.14193031191825867, 0.011479131877422333, 0.01705317199230194, -0.025878652930259705, 0.1123153567314148, 0.15502208471298218, -0.01763187348842621, -0.0967709943652153, -0.06544534862041473, 0.10017473995685577, 0.24065160751342773, 0.03124273382127285, -0.04303497076034546, 0.25563278794288635, 0.050710879266262054, 0.0012873364612460136, -0.0189458429813385, 0.09679747372865677, -0.049844928085803986, -0.0770675465464592, -0.04098142310976982, 0.021227167919278145, -0.006169749423861504, -0.03320905566215515, -0.014049744233489037, 0.12192551791667938, -0.07439190149307251, 0.19906844198703766, -0.07574999332427979, 0.04171018674969673, -0.0807032361626625, -0.026245908811688423, -0.10468650609254837, -0.017001882195472717, 0.18052427470684052, -0.1390213817358017, 0.147769033908844, 0.1543234884738922, -0.004886556416749954, 0.13223575055599213, 0.11747393012046814, 0.1311926692724228, 0.031187979504466057, -0.07234233617782593, -0.234019473195076, -0.045564793050289154, 0.08715971559286118, -0.06486799567937851, 0.06178845465183258, 0.04505538195371628],
                            [-0.1389542669057846, 0.1536124050617218, 0.07493049651384354, -0.04188160225749016, -0.1441425234079361, 0.040961045771837234, -0.04684962332248688, -0.056656502187252045, 0.11257902532815933, -0.16907811164855957, 0.19720618426799774, 0.0010074172168970108, -0.24705436825752258, 0.03661814332008362, 0.027292080223560333, 0.1868741661310196, -0.0860152542591095, -0.10773877054452896, -0.16619139909744263, -0.10421820729970932, 0.05023174732923508, 0.13502636551856995, -0.1278010457754135, 0.049058325588703156, -0.12712019681930542, -0.2631937861442566, -0.06201501935720444, -0.025250636041164398, 0.007746330462396145, -0.07229538261890411, -0.021603647619485855, 0.06038711592555046, -0.12198442965745926, 0.022649750113487244, 0.009925758466124535, 0.055567070841789246, -0.044365886598825455, -0.06930135190486908, 0.17838990688323975, 0.030860036611557007, -0.20299731194972992, 0.012012878432869911, 0.06898325681686401, 0.2190716564655304, 0.14926812052726746, -0.034400831907987595, 0.0689592957496643, -0.07790546119213104, 0.09640930593013763, -0.2641158103942871, 0.05727990344166756, 0.1451546549797058, 0.03616871312260628, 0.1260949671268463, 0.0164957232773304, -0.2317727506160736, -0.02462323009967804, 0.13407588005065918, -0.17099696397781372, 0.09852428734302521, 0.10145002603530884, -0.17525988817214966, -0.12573237717151642, -0.04432179406285286, 0.15053458511829376, 0.13805131614208221, -0.12430056929588318, -0.2303926944732666, 0.14062806963920593, -0.19230280816555023, -0.061901818960905075, 0.11897691339254379, -0.13177835941314697, -0.18510687351226807, -0.2946510314941406, 0.12214239686727524, 0.3788558840751648, 0.19082613289356232, -0.170440211892128, -0.0038848379626870155, 0.0031865364871919155, -0.01981106959283352, 0.13340982794761658, 0.13086560368537903, -0.0048105549067258835, -0.09187887609004974, -0.05887569859623909, 0.10214287787675858, 0.23838560283184052, 0.016884855926036835, -0.025237130001187325, 0.2784949541091919, 0.0763130635023117, 0.003194449469447136, -0.02185114100575447, 0.1028144359588623, -0.06230469420552254, -0.10332202166318893, -0.05605539306998253, 0.018303312361240387, 0.039568617939949036, -0.05212516710162163, -0.031147291883826256, 0.12523896992206573, -0.10364021360874176, 0.21726369857788086, -0.05254273861646652, 0.03514868766069412, -0.052940551191568375, -0.02404962293803692, -0.10684432089328766, -0.002619484905153513, 0.1814163476228714, -0.13038352131843567, 0.13049359619617462, 0.14521028101444244, 0.015373107977211475, 0.11777211725711823, 0.12827499210834503, 0.10537608712911606, 0.025103110820055008, -0.06986778229475021, -0.23305577039718628, -0.06537915766239166, 0.09301482141017914, -0.052532024681568146, 0.03444891422986984, 0.024978268891572952],
                            [-0.12348581105470657, 0.16398954391479492, 0.1107315868139267, 0.009025215171277523, -0.13695962727069855, 0.028667191043496132, -0.05285195633769035, -0.08661156892776489, 0.07388655841350555, -0.1717226803302765, 0.1916792243719101, -0.008152438327670097, -0.20861786603927612, 0.06205287575721741, 0.03623642772436142, 0.16139250993728638, -0.10254146158695221, -0.11982449889183044, -0.16662190854549408, -0.07550356537103653, 0.022705120965838432, 0.12177418172359467, -0.08934881538152695, 0.03770268335938454, -0.11992424726486206, -0.24083442986011505, -0.053148623555898666, -0.037499066442251205, 0.03661876544356346, -0.07382796704769135, -0.047012049704790115, 0.039973847568035126, -0.0967511385679245, 0.04259217530488968, 0.016908619552850723, 0.015744268894195557, -0.03628132864832878, -0.05481799319386482, 0.21828711032867432, -0.0018943827599287033, -0.21047523617744446, 0.0118731539696455, 0.0728120431303978, 0.22459232807159424, 0.1829889714717865, -0.017875609919428825, 0.02411770448088646, -0.05105334520339966, 0.10983792692422867, -0.26949581503868103, 0.07694272696971893, 0.12610319256782532, 0.046708300709724426, 0.1505773514509201, 0.021951589733362198, -0.25628364086151123, -0.04092244803905487, 0.11664579808712006, -0.1392916440963745, 0.12280023843050003, 0.07276667654514313, -0.18503394722938538, -0.07787180691957474, -0.052206605672836304, 0.16113071143627167, 0.13953183591365814, -0.10022015869617462, -0.22350044548511505, 0.12507669627666473, -0.196699857711792, -0.06446985900402069, 0.12075616419315338, -0.13787204027175903, -0.15891672670841217, -0.27123916149139404, 0.08981122821569443, 0.35368502140045166, 0.1812150925397873, -0.1789444088935852, -0.036841608583927155, 0.04061255231499672, -0.037247173488140106, 0.1086275726556778, 0.13225820660591125, -0.018390828743577003, -0.10487428307533264, -0.0388389527797699, 0.06910242885351181, 0.24400781095027924, 0.005528060719370842, -0.042032524943351746, 0.26681655645370483, 0.04487931728363037, -0.0064435601234436035, -0.012253908440470695, 0.07058148086071014, -0.04429398477077484, -0.08896201848983765, -0.06645028293132782, 0.02546008676290512, 0.009518429636955261, -0.0708409994840622, -0.023870164528489113, 0.14204490184783936, -0.11999304592609406, 0.2004159390926361, -0.06592849642038345, 0.048614587634801865, -0.04106883704662323, 0.012299913913011551, -0.10115976631641388, -0.00748776039108634, 0.19039563834667206, -0.13468118011951447, 0.16636215150356293, 0.1589137315750122, 0.02595411241054535, 0.10591290891170502, 0.07760880142450333, 0.10895230621099472, 0.02813572809100151, -0.0030488744378089905, -0.20639799535274506, -0.06322432309389114, 0.09230094403028488, -0.06165281683206558, 0.024112707003951073, 0.04994874447584152],
                            [-0.12170030176639557, 0.1608731895685196, 0.11334867775440216, 0.002356714801862836, -0.14411483705043793, 0.03343374654650688, -0.05818812549114227, -0.09034831076860428, 0.07938268780708313, -0.18399964272975922, 0.20466025173664093, -0.010809872299432755, -0.19822049140930176, 0.05488438159227371, 0.044237129390239716, 0.17654061317443848, -0.11633297055959702, -0.11703331768512726, -0.1486709713935852, -0.08251052349805832, 0.04975787550210953, 0.10643284022808075, -0.0825539082288742, 0.030273541808128357, -0.12969738245010376, -0.2504512667655945, -0.0295370165258646, -0.03807898610830307, 0.011600783094763756, -0.0805869773030281, -0.03673846274614334, 0.055295370519161224, -0.10743969678878784, 0.06349121779203415, -0.0045747943222522736, 0.03098539635539055, -0.04537208005785942, -0.052162811160087585, 0.2064608633518219, -0.012828142382204533, -0.2199661284685135, 0.03066045418381691, 0.056147247552871704, 0.218516543507576, 0.2211150974035263, -0.024384023621678352, 0.01639670878648758, -0.06553944945335388, 0.1165977492928505, -0.2921734154224396, 0.04645124822854996, 0.11536558717489243, 0.02351010963320732, 0.12339454144239426, 0.009920796379446983, -0.22916805744171143, -0.029956940561532974, 0.09143786132335663, -0.15516026318073273, 0.08474671840667725, 0.08715158700942993, -0.20391744375228882, -0.08320075273513794, -0.06114715337753296, 0.1675969362258911, 0.12675364315509796, -0.11002683639526367, -0.19676193594932556, 0.09673677384853363, -0.19034560024738312, -0.0642637386918068, 0.12647022306919098, -0.13189487159252167, -0.18283069133758545, -0.27505970001220703, 0.08824637532234192, 0.38437673449516296, 0.17247454822063446, -0.18912096321582794, -0.03218097984790802, 0.04518682137131691, -0.03476989269256592, 0.13375240564346313, 0.13554896414279938, 0.0002855081111192703, -0.1226811334490776, -0.0646747276186943, 0.08467506617307663, 0.2470470815896988, -0.018087666481733322, -0.0333435982465744, 0.27303197979927063, 0.0496734194457531, -0.007517695426940918, -0.02429209277033806, 0.0911945104598999, -0.050953805446624756, -0.06709543615579605, -0.08025326579809189, 0.010761532001197338, 0.005779367871582508, -0.055578164756298065, -0.03588428720831871, 0.13043585419654846, -0.12563177943229675, 0.2225942313671112, -0.07494764775037766, 0.038514792919158936, -0.04228557273745537, -0.03602951392531395, -0.09057788550853729, 0.011933302506804466, 0.17575295269489288, -0.13741348683834076, 0.12950164079666138, 0.16081005334854126, 0.031543098390102386, 0.12771332263946533, 0.0761515349149704, 0.10133973509073257, 0.008097834885120392, -0.008979659527540207, -0.23358508944511414, -0.04855935648083687, 0.09645311534404755, -0.04822428524494171, 0.04026642441749573, 0.03715129196643829],
                            [-0.11037535965442657, 0.17166128754615784, 0.10973026603460312, -0.008946500718593597, -0.1370144635438919, 0.0350179523229599, -0.05874112248420715, -0.07013864070177078, 0.10491324961185455, -0.17569103837013245, 0.1931205838918686, 0.002075479831546545, -0.1982204020023346, 0.05520693585276604, 0.02113528549671173, 0.18495841324329376, -0.10252031683921814, -0.1318647563457489, -0.13633668422698975, -0.0706704631447792, 0.04327859729528427, 0.10418960452079773, -0.09897582232952118, 0.028712976723909378, -0.11201423406600952, -0.2688034772872925, -0.05715755373239517, -0.02410999685525894, -0.0023780586197972298, -0.07375285774469376, -0.03356565535068512, 0.060524385422468185, -0.11084544658660889, 0.04177139326930046, 0.008511857129633427, 0.02688456140458584, -0.02846437692642212, -0.05339338630437851, 0.19087186455726624, -0.0023888051509857178, -0.20606589317321777, 0.039152007550001144, 0.048667360097169876, 0.23254889249801636, 0.18938487768173218, -0.02407662384212017, 0.04452427849173546, -0.05727478116750717, 0.115367591381073, -0.2713041305541992, 0.05323769152164459, 0.11846113950014114, 0.034069862216711044, 0.1364368349313736, 0.005747019778937101, -0.23477602005004883, -0.023406315594911575, 0.11679904162883759, -0.1622764766216278, 0.09144851565361023, 0.0686492994427681, -0.1979854702949524, -0.07346882671117783, -0.04014364257454872, 0.18162190914154053, 0.1425662338733673, -0.10645200312137604, -0.2274445742368698, 0.1159796267747879, -0.1703823208808899, -0.04689180105924606, 0.0979202389717102, -0.14763621985912323, -0.1689653992652893, -0.27641335129737854, 0.1091868132352829, 0.35787174105644226, 0.16022256016731262, -0.16792786121368408, 0.005218544974923134, 0.02718377113342285, -0.00981425866484642, 0.09903914481401443, 0.13118882477283478, -0.01259684655815363, -0.09120000153779984, -0.05858294293284416, 0.09188254177570343, 0.242445707321167, -0.007806163281202316, -0.047336429357528687, 0.2667086124420166, 0.025654979050159454, 0.002781257964670658, -0.019796911627054214, 0.09162986278533936, -0.04341484606266022, -0.05732114985585213, -0.06491131335496902, 0.03331415355205536, 0.01890929415822029, -0.051517851650714874, -0.029992518946528435, 0.1334487795829773, -0.12704509496688843, 0.19812825322151184, -0.08994776755571365, 0.06261985749006271, -0.06031232699751854, -0.02024943381547928, -0.09142425656318665, 0.012287244200706482, 0.17128919064998627, -0.15267036855220795, 0.1664486527442932, 0.1512691229581833, 0.016795268282294273, 0.12731775641441345, 0.08215849846601486, 0.08390746265649796, 0.029209278523921967, -0.03329126536846161, -0.219815194606781, -0.04501083493232727, 0.10401838272809982, -0.03887871280312538, 0.036394041031599045, 0.05231788381934166],
                            [-0.12473268806934357, 0.15447179973125458, 0.1112605631351471, 0.0018833966460078955, -0.11935567855834961, 0.031659528613090515, -0.0651305764913559, -0.06410658359527588, 0.07720086723566055, -0.16922646760940552, 0.1835097074508667, 0.00762771675363183, -0.21016600728034973, 0.06715599447488785, 0.029466047883033752, 0.15819159150123596, -0.08140145242214203, -0.10476846992969513, -0.1576251983642578, -0.08830763399600983, 0.05152342468500137, 0.124915711581707, -0.09545774012804031, 0.025256559252738953, -0.10188639163970947, -0.24750421941280365, -0.032570503652095795, -0.020894356071949005, 0.020711513236165047, -0.07027316093444824, -0.029959246516227722, 0.04402042180299759, -0.09632565826177597, 0.062024544924497604, 0.005670671351253986, 0.03369920328259468, -0.02789963223040104, -0.04168140888214111, 0.20106762647628784, 0.008523545227944851, -0.20604529976844788, 0.014139658771455288, 0.05353868007659912, 0.23562876880168915, 0.18308313190937042, -0.02468806505203247, 0.0397072434425354, -0.05650753527879715, 0.11139277368783951, -0.2797674238681793, 0.06797315180301666, 0.12505948543548584, 0.04257401451468468, 0.13731369376182556, 0.022286001592874527, -0.25242215394973755, -0.031091079115867615, 0.10396920889616013, -0.1271047294139862, 0.11534733325242996, 0.07563430815935135, -0.183730348944664, -0.09257999807596207, -0.05136910453438759, 0.16766852140426636, 0.1240583136677742, -0.11743950098752975, -0.2089373767375946, 0.10458282381296158, -0.1768430918455124, -0.0547633022069931, 0.11517691612243652, -0.1414937674999237, -0.1646546870470047, -0.265502005815506, 0.10981292277574539, 0.36340656876564026, 0.162366583943367, -0.18692713975906372, -0.011982102878391743, 0.03179561719298363, -0.01631196215748787, 0.12361833453178406, 0.13563407957553864, -0.016419557854533195, -0.08875993639230728, -0.043490707874298096, 0.0801968201994896, 0.23741303384304047, -0.0037147467955946922, -0.042706817388534546, 0.25818002223968506, 0.04690752550959587, -0.0004847990348935127, -0.018469389528036118, 0.08813238888978958, -0.03963043540716171, -0.07997783273458481, -0.06794116646051407, 0.02001875452697277, 0.025708191096782684, -0.08080998808145523, -0.024332424625754356, 0.12067583203315735, -0.1378391981124878, 0.214161217212677, -0.06338751316070557, 0.056847553700208664, -0.021856803447008133, 0.002235253807157278, -0.09856019914150238, 0.001928965444676578, 0.18202340602874756, -0.13585376739501953, 0.15859158337116241, 0.16392961144447327, 0.03644806519150734, 0.12255389988422394, 0.08733976632356644, 0.11257310956716537, 0.03277834132313728, -0.0023026419803500175, -0.20307663083076477, -0.054284173995256424, 0.07853580266237259, -0.038532454520463943, 0.010148453526198864, 0.04566629230976105]
                            ]

    # output is  the trained weights of the network
    numpy.set_printoptions(threshold=sys.maxsize)
    result = train_rbm(myFaceEmbeddingsData, sc, 128, 20)

    pd.DataFrame(result).to_csv("rbmWeights.csv", header=None, index=None)
    print(result)




